---
title: 使用者、角色與權限(1)
published: 2026-02-08
tags: [Coding, Notes, RBAC]
category: 程式雜記
description: 推翻了好幾次的會員架構設計之後得到的領悟。
draft: false
---

# 裸奔時期

還記得一開始寫第一個系統的時候，完完全全沒有權限的概念。

覺得可以登入，然後密碼有 hash 就好；
<br>
想炫技一點的，還會加上驗證信、驗證碼之類的酷酷東西（？？）

那些東西確實是有幫助沒錯，
<br>
只是我後來越來越覺得，系統最重要的安全防護，其實是基於權限的限制。

或者說，如果你的系統在一開始的設計架構就沒有想清楚，
<br>
那未來需求一旦開始擴張，即便有再多那些酷酷的防護，也只是錦上添花。

該破的洞還是會破，
<br>
不該被使用者看到的資料，還是會露出來。

<hr>

# 為什麼登入防護只是錦上添花？

我想先解釋，為什麼驗證信、驗證碼等等的防護，本質上都只是「錦上添花」。
<br>
因為從根本上來說，它們只是在驗證一件事：

>你是不是一個合法的登入者
>（或是防止機器人、DDoS）

也就是說，它們只負責回答：

>「你能不能進入這個系統？」

僅此而已。

**它們完全不處理資料隔離。**

<hr>

而資料隔離，才是我們在設計一個「有架構的系統」時，真正的第一步。
<br>
它是系統的根本。

白話一點說就是：

我們在抓資料、做服務的時候不可能誰都能看、誰都能用；
<br>
也不可能所有人一登入，就站在管理者、開發者的上帝視角俯瞰一切。

現實世界裡的需求，通常長得像這樣：

- A 行政作業的承辦人員，只需要看到 A 作業相關的資料

- B 處室的主管，只能管理 B 處室底下的文件

- 研究人員，需要(也只被允許)看到特定機台的物料資訊

- 還是這個使用者就真的只是小角色，他登入進來就**只能夠**看到自己的資料。

這些以上基於現實世界的複雜需求，都是**資料隔離**，

:::tip
_而資料隔離，是基於權限劃分來實現的。_
:::

<hr>

# 使用者 = 腳色時期

在我有權限概念之後，我第一個直覺想法是：

>把權限跟腳色綁在一起，
><br>
>然後腳色就直接寫在使用者的資料裡面。

但很快的，

在我學習到多對多資料表關聯之後，

我就意識到這真的是一個**完全沒有在設計的設計** ˊˇˋb

```
id, user_name, email, password, phone, role
// 像是這樣
```
因為問題馬上就來了。

當這個使用者需要另一個角色的時候怎麼辦？

- 我要再創一筆使用者資料？
- 然後只因為角色不同，就變成另一個人？
- 這樣切換權限的時候就要重新登入？？？
<br>
顯然不太可能。

<hr>

於是設計就會自然的拆成：

- user 表
- role 表

:::tip
_使用者與角色，應該是各自獨立的概念。_
:::

再透過一張關聯表，描述「使用者擁有哪些角色」，
<br>
並且可以隨時透過後台，由系統管理員進行調整。

一般來說，做到這一步，
<br>
其實就已經足以應付多數「不太複雜」的需求了。

只是——

**系統永遠都會遇到複雜需求的那一天。**

而那時候，又會發現一個更大的坑……。

<hr>
角色表格在設計的時候可以加上數字編碼，
<br>
權限相對小的可以在下面，
<br>
這樣在寫特定的服務限制的時候有時候還是蠻方便的。

