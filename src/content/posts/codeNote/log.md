---
title: Log - 系統的黑盒子
published: 2026-02-12
tags: [Coding, Notes, Log]
category: 程式雜記
description: 沒寫Log那走過就不會留下痕跡。
draft: false
---

# Log 是甚麼？

一般時候，系統在運作不會留下紀錄，我們也不知道其內部的運作方式，他就像一個黑盒子，外部看不進去，也沒有訊息透出來。

這時候我們要撰寫一些資訊，當時的運作情況。

這樣有助於系統出錯的時候我們可以判斷是哪邊出了問題。

<hr>

# 留下 Log 的目的

留下 Log 的核心目的包含：

- 協助除錯與問題回溯
- 理解系統在特定時間點的實際行為
- 提高未來系統維護與交接時的可讀性

因此，多留下「有意義」的 Log，對於系統的長期維護與穩定性具有極大的幫助。

:::tip
留下Log的時候要知道自己為什麼而留，不要盲目的在系統製造垃圾。
:::

<hr>

# 適合留下 Log 的時機

**重要操作的 try / catch 區段**
>當程式發生例外時，應即時留下錯誤相關的 Log，以保留完整的錯誤脈絡。
>這能避免錯誤被吞掉，導致後續在問題發生後，無從追查實際原因。

**排程執行（Cron / Job）**
>排程任務多半屬於非同步執行，且沒有即時的使用者回饋介面。
>透過 Log，可以確認：
> - 排程是否有正常執行
> - 任務實際執行的時間點
> - 發生錯誤時的失敗原因
>對排程而言，Log 幾乎是唯一的觀察窗口。

<hr>

# Log 內容應包含的基本資訊

在設計 Log 時，可以包含以下資訊：

- 該 Log 是甚麼操作或功能名稱產生的？
- 發生的時間點
- 系統回傳的訊息（Exception / Error Message）

這些基本資訊能協助開發者在除錯時，快速定位問題發生的位置與背景。

<hr>

# Log 設計時常見的踩雷經驗

**Log 完全不分類**

若所有 Log 都寫入同一個檔案中，隨著系統運作時間拉長，記錄量會快速累積。
<br>
當真正需要排查問題時，反而因為資料過多，難以快速找到關鍵資訊。
<br>
改善方式：

>依功能、用途或排程進行 Log 分類
><br>
>例如：每個排程任務各自擁有獨立的 Log 檔案
><br>
>以每小時執行一次的排程 A 為例，可將其 Log 獨立成：
><br>
>a_YYYYMMDD.log

如此一來，當排程發生異常時，能迅速鎖定相關 Log，提高問題排查效率。

<hr>

**批次操作逐筆留下 Log**

在批次刪除、批量更新等情境中，若每一筆資料都留下 Log，會導致：

Log 檔案容量快速膨脹
<br>
增加磁碟 I/O 與儲存成本
<br>
在未定期清理 Log 的情況下，甚至可能影響系統穩定性。
<br>
以前就曾經發生開發機在寫code寫到一半直接當機，一查發現系統空間剩下幾MB，磁碟全部被Log塞滿滿。

改善方式：
<br>

>將批次操作的 Log 進行「濃縮」
>以單一筆 Log 紀錄整體執行結果，例如：
>- 處理筆數
>- 成功與失敗數量
>- 主要錯誤原因

設計 Log 時的目標應是：
在最低的成本下，取得最大的資訊量，
 並在可讀性與儲存成本之間取得平衡。


