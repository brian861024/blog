---
title: 用權限來決定Menu
published: 2026-02-22
tags: [Coding, Notes, RBAC, Menu]
category: 程式雜記
description: Menu是決定服務讓誰用的第一步。
draft: false
---
這篇筆記算是權限的延伸(?)

# 動態Menu是甚麼

動態Menu是根據權限來管理和產生的Nav連結串。

如果我們有權限的設計，那很多時候，服務的連結是需要被管理的，
<br>
像是學生不能看到課程管理，老師不應該看到資料拋轉。

我們把Menu的結構和權限等設定寫在config裡面，
<br>
然後在登入的時候跑迴圈產生Menu表單。

# Menu可視為權責控管的第一防線

Menu 可視為權責控管的第一道防線，用來限制不同權限的使用者，
<br>
能夠在介面上看到哪些系統功能與資訊。

但要特別注意的是，Menu 只負責**該資訊「顯示不顯示」**，
<br>
實際的權限驗證還是要在中介層（Middleware）或後端邏輯裡進行，兩者缺一不可。

# Menu在Config中的結構設計

在 config 中，Menu 會以陣列（array）的形式進行設計，其概念範例如下：

    '對應到翻譯資源的 key' => [
        // 第一組權限條件
        'permission'  => ['權限代碼1', '權限代碼2'],

        // 另一組權限條件（例如不同角色或權限組合）
        'permission2' => ['權限代碼3'],

        // 若有子選單
        'submenu' => [
            '對應到翻譯資源的 key' => [
                'permission' => ['權限代碼'],
                'route'      => '資源名稱',
            ],
        ],

        // 若沒有子選單
        'route' => '資源名稱',
    ],

透過上述結構，可以清楚定義每一層 Menu 所對應的權限條件與路由設定，
<br>
確保系統功能僅對具備相應權限的使用者顯示。

在實務上，不只 Menu 項目本身，每一個可操作的按鈕或功能入口，也都應設定對應的 permission，以決定是否顯示於使用者介面中。

# Menu 與翻譯資源的關係說明

上述例子裏「對應到翻譯資源的 key」這個意思是，對應到翻譯資源的Key。

以Laravel為例子，該 key 會對應到 resources/lang/en（或 tw 等語系）目錄下的翻譯檔案，
<br>
並可在前端透過 Blade 引擎中的 trans() 或 __() 函式取得對應的顯示文字。

因此，若 Menu 需要支援多語系顯示，其 key 的命名方式必須配合翻譯檔案的結構進行設計，才能確保在不同語系下皆能正確顯示。

# Menu 實體的產生與生命週期

Menu 實體會在使用者登入時建立。
<br>
系統會依據使用者目前所擁有的權限，對完整的 Menu 設定進行篩選，
<br>
並組合出實際可呈現的 Menu 結構後，存入 Session 中。

因此，當使用者的權限發生異動時，必須重新登入，才能重新產生並取得最新的 Menu 實體。

該 Menu 陣列在傳遞至前端後，會再透過 trans() 函式進行翻譯處理，最終呈現在使用者介面上。

:::tip
創立Menu的時候要小心不要在迴圈裡面跑資料庫查詢，要把權限都先取出來。
<br>
就是說不能逐條去查該使用者有沒有這個權限，而是先把該使用者的權限都拿出來之後再來篩選。
:::
